<!-- Generated by SpecStory -->

# é¡¹ç›®ä¿®å¤è®¨è®º (2025-05-12 22:27:32)

_**User**_

ä¿®å¤é¡¹ç›®ï¼Œ

---

_**Assistant**_



---

è®©æˆ‘å…ˆäº†è§£é¡¹ç›®ç»“æ„ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆéœ€è¦ä¿®å¤çš„é—®é¢˜ã€‚

---

<details>
            <summary>Listed current directory â€¢ **10** results</summary>
        
| Name |
|-------|
| ğŸ“„ `.gitignore` |
| ğŸ“„ `.cursorindexingignore` |
| ğŸ“ `.specstory` |
| ğŸ“„ `.DS_Store` |
| ğŸ“ `assets` |
| ğŸ“„ `popup.js` |
| ğŸ“ `js` |
| ğŸ“„ `styles.css` |
| ğŸ“„ `popup.html` |
| ğŸ“ `images` |

</details>

---

çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªChromeæ‰©å±•é¡¹ç›®ã€‚è®©æˆ‘å…ˆæ£€æŸ¥ä¸»è¦æ–‡ä»¶ï¼ŒæŸ¥çœ‹æ½œåœ¨é—®é¢˜ã€‚

---

Read file: popup.html

---

Read file: popup.js

---

<details>
            <summary>Listed directory js â€¢ **11** results</summary>
        
| Name |
|-------|
| ğŸ“„ `image_fixer.js` |
| ğŸ“„ `extension_image_loader.js` |
| ğŸ“„ `image_loader.js` |
| ğŸ“„ `image_fixer.js.bak` |
| ğŸ“„ `image_fixer_improved.js` |
| ğŸ“„ `hexagrams_mapping.js` |
| ğŸ“„ `html_enhancer.js` |
| ğŸ“„ `image_diagnostic.js` |
| ğŸ“„ `hexagram_controller.js` |
| ğŸ“„ `hexagram_data_processor.js` |
| ğŸ“„ `fix_all_hexagram_images.js` |

</details>

---

<details>
            <summary>Listed directory images â€¢ **5** results</summary>
        
| Name |
|-------|
| ğŸ“„ `logo.png` |
| ğŸ“„ `placeholder.png` |
| ğŸ“„ `icon128.png` |
| ğŸ“„ `icon16.png` |
| ğŸ“„ `icon48.png` |

</details>

---

æ£€æŸ¥ä¸»è¦çš„JavaScriptæ–‡ä»¶ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰æ˜æ˜¾çš„é”™è¯¯ï¼š

---

Read file: js/image_fixer.js

---

Read file: js/image_loader.js

---

Read file: js/hexagram_controller.js

---

<details>
            <summary>Listed directory assets â€¢ **2** results</summary>
        
| Name |
|-------|
| ğŸ“ `html_combined` |
| ğŸ“ `hexagram_images` |

</details>

---

Read file: js/hexagrams_mapping.js

---

æ ¹æ®æˆ‘å¯¹ä»£ç çš„åˆ†æï¼Œæˆ‘å‘ç°äº†ä»¥ä¸‹é—®é¢˜éœ€è¦ä¿®å¤ï¼š

1. å›¾ç‰‡è·¯å¾„é—®é¢˜ï¼šå›¾ç‰‡è·¯å¾„åœ¨Chromeæ‰©å±•ä¸­å¤„ç†æ–¹å¼ä¸æ­£ç¡®ï¼Œå¤šä¸ªè„šæœ¬ï¼ˆimage_fixer.js, image_loader.jsï¼‰éƒ½åœ¨å°è¯•è§£å†³åŒä¸€ä¸ªé—®é¢˜ã€‚
2. å¤šä¸ªå›¾ç‰‡ä¿®å¤è„šæœ¬ï¼šæœ‰å¤šä¸ªç‰ˆæœ¬çš„image_fixer.jsï¼ˆåŒ…æ‹¬å¤‡ä»½å’Œæ”¹è¿›ç‰ˆï¼‰ã€‚
3. èµ„æºåŠ è½½é—®é¢˜ï¼šimagesç›®å½•ä¸­çš„å›¾ç‰‡æ–‡ä»¶å¤§å°ä¸º1å­—èŠ‚ï¼Œè¯´æ˜å¯èƒ½æ˜¯æŸåæˆ–ä¸¢å¤±çš„ã€‚

ä¸‹é¢æˆ‘å°†è¿›è¡Œä¿®å¤ï¼š

1. é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ£€æŸ¥æœ€é‡è¦çš„å›¾ç‰‡æ–‡ä»¶å¤¹:

---

<details>
            <summary>Listed directory assets/hexagram_images â€¢ **64** results</summary>
        
| Name |
|-------|
| ğŸ“„ `.DS_Store` |
| ğŸ“„ `hexagram_url_mapping.txt` |
| ğŸ“ `64_æœªæµå¦` |
| ğŸ“ `63_æ—¢æµå¦` |
| ğŸ“ `62_å°è¿‡å¦` |
| ğŸ“ `61_ä¸­å­šå¦` |
| ğŸ“ `60_èŠ‚å¦` |
| ğŸ“ `59_æ¶£å¦` |
| ğŸ“ `58_å…‘å¦` |
| ğŸ“ `57_å·½å¦` |
| ğŸ“ `56_æ—…å¦` |
| ğŸ“ `55_ä¸°å¦` |
| ğŸ“ `54_å½’å¦¹å¦` |
| ğŸ“ `53_æ¸å¦` |
| ğŸ“ `52_è‰®å¦` |
| ğŸ“ `50_é¼å¦` |
| ğŸ“ `49_é©å¦` |
| ğŸ“ `48_äº•å¦` |
| ğŸ“ `47_å›°å¦` |
| ğŸ“ `46_å‡å¦` |
| ğŸ“ `45_èƒå¦` |
| ğŸ“ `44_å§¤å¦` |
| ğŸ“ `43_å¤¬å¦` |
| ğŸ“ `42_ç›Šå¦` |
| ğŸ“ `41_æŸå¦` |
| ğŸ“ `40_è§£å¦` |
| ğŸ“ `39_è¹‡å¦` |
| ğŸ“ `38_ç½å¦` |
| ğŸ“ `36_æ˜å¤·å¦` |
| ğŸ“ `35_æ™‹å¦` |
| ğŸ“ `34_å¤§å£®å¦` |
| ğŸ“ `33_éå¦` |
| ğŸ“ `32_æ’å¦` |
| ğŸ“ `31_å’¸å¦` |
| ğŸ“ `30_ç¦»å¦` |
| ğŸ“ `29_åå¦` |
| ğŸ“ `28_å¤§è¿‡å¦` |
| ğŸ“ `27_é¢å¦` |
| ğŸ“ `26_å¤§ç•œå¦` |
| ğŸ“ `25_æ— å¦„å¦` |
| ğŸ“ `24_å¤å¦` |
| ğŸ“ `23_å‰¥å¦` |
| ğŸ“ `22_è´²å¦` |
| ğŸ“ `21_å™¬å—‘å¦` |
| ğŸ“ `20_è§‚å¦` |
| ğŸ“ `19_ä¸´å¦` |
| ğŸ“ `18_è›Šå¦` |
| ğŸ“ `17_éšå¦` |
| ğŸ“ `16_è±«å¦` |
| ğŸ“ `15_è°¦å¦` |
| ğŸ“ `14_å¤§æœ‰å¦` |
| ğŸ“ `13_åŒäººå¦` |
| ğŸ“ `12_å¦å¦` |
| ğŸ“ `11_æ³°å¦` |
| ğŸ“ `10_å±¥å¦` |
| ğŸ“ `09_å°ç•œå¦` |
| ğŸ“ `08_æ¯”å¦` |
| ğŸ“ `07_å¸ˆå¦` |
| ğŸ“ `06_è®¼å¦` |
| ğŸ“ `05_éœ€å¦` |
| ğŸ“ `04_è’™å¦` |
| ğŸ“ `03_å±¯å¦` |
| ğŸ“ `02_å¤å¦` |
| ğŸ“ `01_ä¹¾å¦` |

</details>

---

è®©æˆ‘æ£€æŸ¥ä¸€ä¸ªå¦è±¡ç›®å½•ï¼Œçœ‹çœ‹å›¾ç‰‡æ˜¯å¦å­˜åœ¨ï¼š

---

<details>
            <summary>Listed directory assets/hexagram_images/01_ä¹¾å¦ â€¢ **1** results</summary>
        
| Name |
|-------|
| ğŸ“ `æœ¬å¦` |

</details>

---

<details>
            <summary>Listed directory assets/hexagram_images/01_ä¹¾å¦/æœ¬å¦ â€¢ **10** results</summary>
        
| Name |
|-------|
| ğŸ“„ `01_ä¹¾å¦_æœ¬å¦_06.jpg` |
| ğŸ“„ `01_ä¹¾å¦_æœ¬å¦_07.jpg` |
| ğŸ“„ `01_ä¹¾å¦_æœ¬å¦_08.jpg` |
| ğŸ“„ `01_ä¹¾å¦_æœ¬å¦_09.jpg` |
| ğŸ“„ `01_ä¹¾å¦_æœ¬å¦_10.jpg` |
| ğŸ“„ `01_ä¹¾å¦_æœ¬å¦_01.jpg` |
| ğŸ“„ `01_ä¹¾å¦_æœ¬å¦_02.jpg` |
| ğŸ“„ `01_ä¹¾å¦_æœ¬å¦_03.jpg` |
| ğŸ“„ `01_ä¹¾å¦_æœ¬å¦_04.jpg` |
| ğŸ“„ `01_ä¹¾å¦_æœ¬å¦_05.jpg` |

</details>

---

å¥½æ¶ˆæ¯ï¼å¦è±¡å›¾ç‰‡å­˜åœ¨ï¼Œä½†å¯èƒ½æœ‰è·¯å¾„å¼•ç”¨é—®é¢˜ã€‚ç°åœ¨æ£€æŸ¥HTMLå†…å®¹ç›®å½•ï¼š

---

<details>
            <summary>Listed directory assets/html_combined â€¢ **64** results</summary>
        
| Name |
|-------|
| ğŸ“„ `hexagram_01_combined.html` |
| ğŸ“„ `hexagram_63_combined.html` |
| ğŸ“„ `hexagram_64_combined.html` |
| ğŸ“„ `hexagram_58_combined.html` |
| ğŸ“„ `hexagram_59_combined.html` |
| ğŸ“„ `hexagram_60_combined.html` |
| ğŸ“„ `hexagram_61_combined.html` |
| ğŸ“„ `hexagram_62_combined.html` |
| ğŸ“„ `hexagram_54_combined.html` |
| ğŸ“„ `hexagram_55_combined.html` |
| ğŸ“„ `hexagram_56_combined.html` |
| ğŸ“„ `hexagram_57_combined.html` |
| ğŸ“„ `hexagram_49_combined.html` |
| ğŸ“„ `hexagram_50_combined.html` |
| ğŸ“„ `hexagram_51_combined.html` |
| ğŸ“„ `hexagram_52_combined.html` |
| ğŸ“„ `hexagram_53_combined.html` |
| ğŸ“„ `hexagram_44_combined.html` |
| ğŸ“„ `hexagram_45_combined.html` |
| ğŸ“„ `hexagram_46_combined.html` |
| ğŸ“„ `hexagram_47_combined.html` |
| ğŸ“„ `hexagram_48_combined.html` |
| ğŸ“„ `hexagram_39_combined.html` |
| ğŸ“„ `hexagram_40_combined.html` |
| ğŸ“„ `hexagram_41_combined.html` |
| ğŸ“„ `hexagram_42_combined.html` |
| ğŸ“„ `hexagram_43_combined.html` |
| ğŸ“„ `hexagram_35_combined.html` |
| ğŸ“„ `hexagram_36_combined.html` |
| ğŸ“„ `hexagram_37_combined.html` |
| ğŸ“„ `hexagram_38_combined.html` |
| ğŸ“„ `hexagram_30_combined.html` |
| ğŸ“„ `hexagram_31_combined.html` |
| ğŸ“„ `hexagram_32_combined.html` |
| ğŸ“„ `hexagram_33_combined.html` |
| ğŸ“„ `hexagram_34_combined.html` |
| ğŸ“„ `hexagram_26_combined.html` |
| ğŸ“„ `hexagram_27_combined.html` |
| ğŸ“„ `hexagram_28_combined.html` |
| ğŸ“„ `hexagram_29_combined.html` |
| ğŸ“„ `hexagram_24_combined.html` |
| ğŸ“„ `hexagram_25_combined.html` |
| ğŸ“„ `hexagram_20_combined.html` |
| ğŸ“„ `hexagram_21_combined.html` |
| ğŸ“„ `hexagram_22_combined.html` |
| ğŸ“„ `hexagram_23_combined.html` |
| ğŸ“„ `hexagram_15_combined.html` |
| ğŸ“„ `hexagram_16_combined.html` |
| ğŸ“„ `hexagram_17_combined.html` |
| ğŸ“„ `hexagram_18_combined.html` |
| ğŸ“„ `hexagram_19_combined.html` |
| ğŸ“„ `hexagram_11_combined.html` |
| ğŸ“„ `hexagram_12_combined.html` |
| ğŸ“„ `hexagram_13_combined.html` |
| ğŸ“„ `hexagram_14_combined.html` |
| ğŸ“„ `hexagram_06_combined.html` |
| ğŸ“„ `hexagram_07_combined.html` |
| ğŸ“„ `hexagram_08_combined.html` |
| ğŸ“„ `hexagram_09_combined.html` |
| ğŸ“„ `hexagram_10_combined.html` |
| ğŸ“„ `hexagram_02_combined.html` |
| ğŸ“„ `hexagram_03_combined.html` |
| ğŸ“„ `hexagram_04_combined.html` |
| ğŸ“„ `hexagram_05_combined.html` |

</details>

---

ç°åœ¨æˆ‘å·²ç»äº†è§£åˆ°é¡¹ç›®çš„åŸºæœ¬ç»“æ„å’Œèµ„æºæƒ…å†µã€‚ä¸»è¦é—®é¢˜æ˜¯ï¼š

1. å›¾ç‰‡å¼•ç”¨è·¯å¾„ä¸æ­£ç¡® - image_loader.jsä¸­çš„è·¯å¾„å‰ç¼€ä¸å®é™…èµ„æºè·¯å¾„ä¸åŒ¹é…
2. imagesæ–‡ä»¶å¤¹ä¸­çš„å›¾æ ‡æ–‡ä»¶å¤§å°ä¸º1å­—èŠ‚ï¼Œå¯èƒ½å·²æŸå
3. å­˜åœ¨å¤šä¸ªå›¾ç‰‡ä¿®å¤è„šæœ¬ç‰ˆæœ¬ï¼Œéœ€è¦æ•´åˆ

è®©æˆ‘ç°åœ¨å¼€å§‹ä¿®å¤è¿™äº›é—®é¢˜ï¼š

1. é¦–å…ˆï¼Œä¿®å¤image_loader.jsä¸­çš„è·¯å¾„é—®é¢˜ï¼š

---

```diff
  class HexagramImageLoader {
    constructor() {
-     this.imageBasePath = '../hexagram_book/hexagram_images/';
+     this.imageBasePath = '../assets/hexagram_images/';
      this.imageCache = {};
    }
```

```diff
      const imageNumber = imageIndex.toString().padStart(2, '0');
      
-     // æ ¹æ®å¦è±¡ç¼–å·ç¡®å®šæ–‡ä»¶å¤¹åç§°
-     let folderName = '';
+     // æ ¹æ®å¦è±¡ç¼–å·æ„å»ºæ­£ç¡®çš„æ–‡ä»¶å¤¹è·¯å¾„
+     const folderName = `${paddedNumber}_${this.getHexagramNameById(hexagramNumber)}å¦`;
      
-     switch (hexagramNumber) {
-       case 1:
-         folderName = '01_ä¹¾å¦';
-         break;
-       case 2:
-         folderName = '02_å¤å¦';
-         break;
-       // å…¶ä»–å¦è±¡çš„æ–‡ä»¶å¤¹åç§°å¯ä»¥ç±»ä¼¼å®šä¹‰
-       default:
-         // å¦‚æœæ²¡æœ‰æ˜ç¡®å®šä¹‰ï¼Œå°è¯•ç”¨æ•°å­—å‰ç¼€
-         folderName = `${paddedNumber}_å¦`;
-     }
-     
-     return `${this.imageBasePath}${folderName}/æœ¬å¦/${imageNumber}.jpg`;
+     return `${this.imageBasePath}${folderName}/æœ¬å¦/${paddedNumber}_${this.getHexagramNameById(hexagramNumber)}å¦_æœ¬å¦_${imageNumber}.jpg`;
+   }
+   
+   // æ ¹æ®å¦è±¡IDè·å–å¦è±¡åç§°
+   getHexagramNameById(hexagramId) {
+     const hexagramNames = [
+       "ä¹¾", "å¤", "å±¯", "è’™", "éœ€", "è®¼", "å¸ˆ", "æ¯”", 
+       "å°ç•œ", "å±¥", "æ³°", "å¦", "åŒäºº", "å¤§æœ‰", "è°¦", "è±«", 
+       "éš", "è›Š", "ä¸´", "è§‚", "å™¬å—‘", "è´²", "å‰¥", "å¤", 
+       "æ— å¦„", "å¤§ç•œ", "é¢", "å¤§è¿‡", "å", "ç¦»", "å’¸", "æ’", 
+       "é", "å¤§å£®", "æ™‹", "æ˜å¤·", "å®¶äºº", "ç½", "è¹‡", "è§£", 
+       "æŸ", "ç›Š", "å¤¬", "å§¤", "èƒ", "å‡", "å›°", "äº•", 
+       "é©", "é¼", "éœ‡", "è‰®", "æ¸", "å½’å¦¹", "ä¸°", "æ—…", 
+       "å·½", "å…‘", "æ¶£", "èŠ‚", "ä¸­å­š", "å°è¿‡", "æ—¢æµ", "æœªæµ"
+     ];
+     
+     if (hexagramId >= 1 && hexagramId <= 64) {
+       return hexagramNames[hexagramId - 1];
+     }
+     
+     return "";
    }
    
```

---

2. ç°åœ¨ï¼Œä¿®å¤image_fixer.jsï¼Œæ•´åˆæ”¹è¿›ç‰ˆæœ¬çš„é€»è¾‘ï¼š

---

```diff
      this.baseUrl = `chrome-extension://${this.extensionId}`;
      this.imageExtensions = ['.jpg', '.png', '.gif'];
+     this.debugMode = false; // åœ¨æ§åˆ¶å°è¾“å‡ºè°ƒè¯•ä¿¡æ¯
    }
  
    // ä¿®å¤å›¾ç‰‡è·¯å¾„
    fixImagePath(originalPath) {
+     if (this.debugMode) {
+       console.log(`å‡†å¤‡ä¿®å¤è·¯å¾„: ${originalPath}`);
+     }
+ 
      // å¦‚æœå·²ç»æ˜¯chrome-extension://æ ¼å¼ï¼Œåˆ™ä¸å¤„ç†
      if (originalPath.startsWith('chrome-extension://')) {
```

```diff
      let path = originalPath.replace(/^\.\.\/|^\.\//g, '');
  
-     // å¤„ç†hexagram_bookå‰ç¼€
+     // ç¡®ä¿èµ„æºä½¿ç”¨æ­£ç¡®çš„ç›®å½•ç»“æ„
      if (path.includes('hexagram_book/')) {
-       path = path.replace('hexagram_book/', '');
+       path = path.replace('hexagram_book/', 'assets/');
      }
  
-     // ç¡®ä¿è·¯å¾„ä»¥hexagram_imageså¼€å¤´
-     if (!path.startsWith('hexagram_images/')) {
-       path = `hexagram_images/${path}`;
+     // å¤„ç†å¦è±¡å›¾ç‰‡è·¯å¾„
+     if (path.includes('hexagram_images/') || 
+         path.match(/\d{2}_.*å¦\/æœ¬å¦\/.*\.jpg/)) {
+       // ç¡®ä¿è·¯å¾„åŒ…å«assetsç›®å½•
+       if (!path.startsWith('assets/')) {
+         path = `assets/${path}`;
+       }
      }
  
+     // ä½¿ç”¨æ‰©å±•IDæ„å»ºå®Œæ•´URL
      return `${this.baseUrl}/${path}`;
    }
```

```diff
      const paths = [originalPath];
      
-     // å°è¯•ä¸åŒçš„è·¯å¾„ç»„åˆ
+     // è½¬æ¢ä¸åŒçš„è·¯å¾„æ ¼å¼
      if (originalPath.includes('hexagram_book/')) {
-       paths.push(originalPath.replace('hexagram_book/', ''));
-     } else {
-       paths.push(`hexagram_book/${originalPath}`);
+       paths.push(originalPath.replace('hexagram_book/', 'assets/'));
+     } else if (!originalPath.includes('assets/')) {
+       paths.push(`assets/${originalPath}`);
+     }
+ 
+     if (originalPath.includes('hexagram_images/')) {
+       // è·¯å¾„å·²ç»åŒ…å«hexagram_images
+     } else if (originalPath.match(/\d{2}_.*å¦\//)) {
+       // æ·»åŠ hexagram_imageså‰ç¼€
+       paths.push(`assets/hexagram_images/${originalPath.replace('assets/', '')}`);
      }
  
```

```diff
      const originalSrc = img.getAttribute('data-original-src') || img.src;
      const fallbackPaths = this.createFallbackPaths(originalSrc);
-     
+     
+     if (this.debugMode) {
+       console.log(`å›¾ç‰‡åŠ è½½å¤±è´¥: ${img.src}`);
+       console.log(`å°è¯•å¤‡ç”¨è·¯å¾„:`, fallbackPaths);
+     }
+ 
      // å°è¯•ä¸‹ä¸€ä¸ªå¤‡ç”¨è·¯å¾„
      const currentIndex = fallbackPaths.indexOf(img.src);
      if (currentIndex < fallbackPaths.length - 1) {
        img.src = fallbackPaths[currentIndex + 1];
+       if (this.debugMode) {
+         console.log(`å°è¯•æ–°è·¯å¾„: ${img.src}`);
+       }
      } else {
        // æ‰€æœ‰è·¯å¾„éƒ½å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯æç¤º
```

```diff
  // åœ¨DOMåŠ è½½å®Œæˆæ—¶ä¿®å¤å›¾ç‰‡
  document.addEventListener('DOMContentLoaded', () => {
+   console.log('æ­£åœ¨ä¿®å¤é¡µé¢å›¾ç‰‡è·¯å¾„...');
    imageFixer.fixAllImages();
  });
```

---

3. ä¿®å¤hexagram_controller.jsä¸­çš„è·¯å¾„é—®é¢˜ï¼š

---

```diff
    }
    
-   // è·å–å¦è±¡å¯¹åº”çš„HTMLæ–‡ä»¶è·¯å¾„
+   // è·å–å¦è±¡HTMLæ–‡ä»¶è·¯å¾„
    getHexagramHtmlPath(hexagramId) {
-     const paddedId = hexagramId.toString().padStart(2, '0');
-     return this.safeGetURL(`html_combined/hexagram_${paddedId}_combined.html`);
+     const paddedNumber = hexagramId.toString().padStart(2, '0');
+     const filename = `hexagram_${paddedNumber}_combined.html`;
+     return `../assets/html_combined/${filename}`;
    }
    
-   // å®‰å…¨è·å–URLçš„å‡½æ•°
+   // å®‰å…¨è·å–URL
    safeGetURL(path) {
      try {
-       // é¦–å…ˆå°è¯•ä½¿ç”¨chrome.runtime.getURL
-       if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.getURL) {
-         return chrome.runtime.getURL(path);
+       // å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œè½¬æ¢ä¸ºchrome-extension://å½¢å¼
+       if (path.startsWith('../') || path.startsWith('./') || !path.includes('://')) {
+         const baseUrl = `chrome-extension://${chrome.runtime.id}`;
+         // ç§»é™¤è·¯å¾„å¼€å¤´çš„../æˆ–./
+         const cleanPath = path.replace(/^\.\.\/|^\.\//g, '');
+         return `${baseUrl}/${cleanPath}`;
        }
+       
+       // å¦‚æœå·²ç»æ˜¯å®Œæ•´URLï¼Œç›´æ¥è¿”å›
+       return path;
      } catch (error) {
-       console.warn('chrome.runtime.getURLå¤±è´¥ï¼Œä½¿ç”¨åå¤‡æ–¹æ³•:', error);
+       console.error('è½¬æ¢URLå¤±è´¥:', error);
+       return path;
      }
-     
-     // åå¤‡æ–¹æ³•ï¼šç›´æ¥è¿”å›ç›¸å¯¹è·¯å¾„
-     return path;
    }
    
```

---

4. æœ€åï¼Œä¿®å¤hexagram_data_processor.jsä¸­çš„è·¯å¾„ï¼š

---

<details>
            <summary>Searched codebase "loadHexagramFile" â€¢ **14** results</summary>
        
| File | Lines |
|------|-------|
| `js/hexagram_data_processor.js` | L200-222 |
| `js/hexagram_controller.js` | L141-192 |
| `js/hexagram_controller.js` | L192-245 |
| `js/hexagram_controller.js` | L307-333 |
| `js/hexagram_controller.js` | L245-286 |
| `js/hexagram_controller.js` | L66-105 |
| `js/hexagram_controller.js` | L23-66 |
| `js/hexagram_controller.js` | L1-11 |
| `js/hexagram_data_processor.js` | L222-277 |
| `js/hexagram_data_processor.js` | L1-8 |
| `js/hexagram_controller.js` | L121-141 |
| `js/image_loader.js` | L79-108 |
| `js/hexagram_data_processor.js` | L19-70 |
| `js/hexagram_data_processor.js` | L8-19 |

</details>

---

Read file: js/hexagram_data_processor.js

---

```diff
    constructor() {
      this.hexagramsData = [];
-     this.basePath = 'html_combined/';
+     this.basePath = 'assets/html_combined/';
    }
  
```

```diff
      };
    }
- 
-   // å®‰å…¨è·å–URLçš„å‡½æ•°
-   safeGetURL(path) {
-     try {
-       // é¦–å…ˆå°è¯•ä½¿ç”¨chrome.runtime.getURL
-       if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.getURL) {
-         return chrome.runtime.getURL(path);
-       }
-     } catch (error) {
-       console.warn('chrome.runtime.getURLå¤±è´¥ï¼Œä½¿ç”¨åå¤‡æ–¹æ³•:', error);
-     }
-     
-     // åå¤‡æ–¹æ³•ï¼šç›´æ¥è¿”å›ç›¸å¯¹è·¯å¾„
-     return path;
-   }
  
    // åŠ è½½å¦è±¡HTMLæ–‡ä»¶
    async loadHexagramFile(filename, hexagramId) {
      try {
        // ä½¿ç”¨å®‰å…¨çš„URLè·å–å‡½æ•°
-       const fileUrl = this.safeGetURL(`html_combined/${filename}`);
+       const fileUrl = this.safeGetURL(`assets/html_combined/${filename}`);
        console.log(`åŠ è½½å¦è±¡æ–‡ä»¶: ${fileUrl}`);
        
```

```diff
      }
    }
+ 
+   // å®‰å…¨è·å–URLçš„å‡½æ•°
+   safeGetURL(path) {
+     try {
+       // å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œè½¬æ¢ä¸ºchrome-extension://å½¢å¼
+       if (path.startsWith('../') || path.startsWith('./') || !path.includes('://')) {
+         const baseUrl = `chrome-extension://${chrome.runtime.id}`;
+         // ç§»é™¤è·¯å¾„å¼€å¤´çš„../æˆ–./
+         const cleanPath = path.replace(/^\.\.\/|^\.\//g, '');
+         return `${baseUrl}/${cleanPath}`;
+       }
+       
+       // å¦‚æœå·²ç»æ˜¯å®Œæ•´URLï¼Œç›´æ¥è¿”å›
+       return path;
+     } catch (error) {
+       console.error('è½¬æ¢URLå¤±è´¥:', error);
+       return path;
+     }
+   }
  
    // ä»HTMLå†…å®¹ä¸­è§£æå¦è±¡æ•°æ®
```

---

5. æ›¿æ¢ç©ºå›¾æ ‡æ–‡ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„å ä½å›¾ï¼š

---

```diff
-  
+ data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAABmJLR0QA/wD/AP+gvaeTAAAE30lEQVR4nO2dW4hVVRjHf+M4ZjqOjpdRs0JNzEq6mBXRM9GLBEb0EL0UvUQEXpq8IGKMUEEUFEQE3cCHLKgoMrMHy7QSKqKLt7I0dRrNS46XcRzn9LDOmTmz1tr77HX2+vbyfeDPnHP2+r611vfttfaFvbbBMAzDMAzDMAzDMAzDiIvJwHKgE+gGDgFrgcsDxlQJU4EtwAAwWPDXDXwBzA8QVyWsJj94hX+fpI/ZB6wC/i70/Qf4GqgnnktVuAF3sg8Cq4GZwELgUJr+O7AwQHyVcB5wkqTidAATCn6n0pQDOJrmGRXjPuLKsLXo9+7UbgC4p+S4KkMXcJykgryZYf9pans0zakKt6B36YuU/VrgD9QK2gfM8R9i9dhDXBGuTeGxAD1YbwPpS/xjwGOpzc6MODrEE1MF2YC6MnrdoeeDJGXkBTFPpRyEKeF+4B70IPl50TI+TQB/A+9nxHM+cIKkXN3gKcZS8Q5xJZidg+dskmrvUzFnAq/iDuBgjngqwVz0ynhdCo+pJAF11w3RW9MJ1tDaS1wRVgr5zAJOkVScxRn2K9L0gaLfK8FO4oqwW8hnO/HYMC+RTs3kgzFyIflVoINkcAZuRa2BPDCqqEPsQ+9y5BVhGLiFuPS7XKQfAVamK82YZgPJwHJVhutlwDFJJkXSUdwDs87kqD7oUnb0GDnFpTSdZuQUt2JYOiOnuEfLlmHkFFtlGDnFjQRGTvEjQCaRgzJSSs3X6CkuZWQUlzISikuZYOQUl9JqRE5xKRuInOJSGkbkFJfSMCKnuJQasVNcypyIKC5leSQVl9L0IipjRlkV0DWxlKqBZBX24fR/XYbtuUTOFuAF3N1XnhzPsXAFyZTuVuE3p2bWbgN+EtKeBS71HWgleBl91+TN9O/XDNt76V9peQTXdL4qxDKNyKclrcR8kopiS9lLRoLZ6FXUdxzNwEyS6y1pSzUy+Rq9km337UClW9naxEhF6cd918rC9N9Vsv2TqZ1pZGMbSY/wsmC/Jr3QXc7wVlW0k7yC+AxX5XDsMu324vDKxK9c1tLLnK7KqaCXXJaH9CQwdeQZ3Jt6Twp5TUXftbkrhLPCmrcJ5b03Kz2kL2U4BViS9aHAL8AXwn6f5nAqb4XMcfyuJXl54LrQvgA/sxC/k4J2A3Cew76t+ZpkdWI/cJljm4eIX4nIWzebQPJKYkewHn0soDGb5K6QE7gXfCehzzGFvIXUoXVr9xO/+roqAScQWoDfgHnKe9eQNKGzwCOlRpSP0irkGMn4oY+k6WjXw4fZQDLOOKh85nqSXsznwP0lxJIHcYUkjYXoM+E1kvg1xsZqkomm9wIPKp87ibjHmJ5nR6k8hr7U5BXiE+YTHJvUasFdiOfMIb5ROa+f1XgYlbskfQJJ0+r0lF7oWpIbJDeR7+JmOvGNIvJW2jbiSnCGUq54XEY8Jsh6CU11mY6+bvk28p3AXPSB6mqfceTG68QV4TnlOpBcFJd6YUVuNCCvtlyEu0l1MQX9/pDFkzz5ljmIfPTwX0WOA8Tvle5wJelDf4TqVWWP1OWBCeYPqU2oD3eP4GNs6qIU1uEOtiuId1t3OPbNNXHUSuxD349bXbIv27W12qqS98nMFRvQnyZ6N1AM2zP22dZsV+W11UbU6sfdNZjGeLYrfbPzNcS3hDQM4xzgP1TKGu8TsCThAAAAAElFTkSuQmCC 
```

---

```diff
-  
+ data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBElEQVQ4y83TMUvDQBTH8V9jCF3UzfYL+AXEtRCXgl9BF9dCJ5faKYOTm0NXlyKCoyJIBgVBC7q0UqR1aA8uQSy1aecXHhzHvfvfvTsOkqNJ4yESe8B+xPlf4gcYsK5TkvVR4CnF/RJLyHpOeAYKJE6DujOHv1iqImBcYHwEmSkEw+dEYI9gbdBgbGCojDOCbsKTkgT7mGsjYArURWHTUm7XEm7Zr9FhDx2r7fcrMJnDPnrYwaJlzxS4xS1ucImOYd3kDWa4xz0ecI4HCy9Xxze+8YlXXKGfBMyzA8O8Gp2kH3jBAyZo4gwHOfZUwMwEPnCDekH4/yyjBpwazpWu9Wez8gsYXkGl+3LJ3QAAAABJRU5ErkJggg== 
```

---

```diff
-  
+ data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAED0lEQVRoge2Zy4scVRTGf6equme6Z8YYHwElJiL4TiIoiCIqGheCCUJA3AjZZuFKBEVw478gCCKCKxUUQReCqGiCigFfiUQlKq7UGNSYTCYz3V3V5biIXV1dXdVdPdMzWfiDpuGec8/9zr2n7r33FMxlLnOZy1z+p5JtaOvgFuBNYDmwbpZs+gi4X1U/A7BKKifbsNbLwM2JN38DPwDrgYWzYOAS4FrLsrYbY74CsLxJDLYCL3iTHcRPgVuBOw4F+0zSmXGHPgCyXgRs4D5gK3AX8BpQnLl9JunKAeuHDpyUHPZVdTPwCbARWDRz22aWksPAjlKp9Kpbl28A0EuBvV5bdvq2FYG3gKdm1KTZkr7l5fL5/LPAN04lVZU/gYKqVoEP6DLsUxQBNgDrReTt1LgLrBpIqb/+zI1HYyeFoyjlT8B9wOXAzojK/E03B5pOrVPxvEynl4Pvp6tOAwR6wCLqNDAoPtWYRwEIL76W2iVTdyAYWNuNMQe9ssdPeIGjjTHjSZIbKe2TlQPxMI/lHfCC6/X1wDER2ZzUITGZtOIk0mmzI3KgJY4Yf+FDvmMGQA6tAfqlsQfeAz4HTgK+Bt7J5/OvN3uj8flWgY6aLY1xwHLJJnOl7jtAgxW0B9aqRbGLbpQD5jjwGrAcuAr4XFWfSK1Sh0Q5Lkl9FUJCz9SuUQjx86zUOHgZ4E0RCcfJRvOSEHYT6F2Fmg60h9yk3bIxoSb+X+6uQt2kKIBDq5BTUwf6wZ0GOlSh5GEWCxjrQesJv3MQf3gDY5DajXwu7HY1jMSHsA3MBgdUYWvIgS4JLF4Cfwbs9GvZcGnw85lIa8VICKWGj7S7kMuZtBPxtlDOtLpQLKTitqcQVpftKV2oX5lVB4LbJmMMx4Q0vJ7Sj3zcVYcagQQVSl7GHGgFr2psFfYG5UBPfK3G/inQNJATduBhYAhYoaoHxrx2SB/LZRwgkgNpt+rKJmPLn0Kcb75QKBQ2ABdVq9X9kFEG4m7GXoTNe+aO4lPrTgcnYp3r0Fao6j0zqz/FpLnKmGQfvQ5MRIHm9bBqLDI+U7l0OKYzaQdSPABsB5Z5x1vX4h/9G7DLeyZMp8WnfK+zHzdCi7Z4D4wBHwGfi8jPbcYHtRdYaYzZDrzqOPGdcgI30FNvABGRLcBS4Hzg2FTDIjoLOACsrtfrO1qJ2vdkCqCqe4CX/MF0E1X9GTgnijzMgANNQqp6CfDJdPV0kj3AZZ0EJs2BrGeMPV1UqoNsB67opGnGtHRE5C7gxmkq3SciL3QzYqo50G3TURPuH9NR+3euczIRKUJ8/zkEkdfn3X+WOc5lLnOZy1wOg/wL8LlFJxH2mxEAAAAASUVORK5CYII= 
```

---

```diff
-  
+ data:image/png;base64,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 
```

---

Cancelled

---


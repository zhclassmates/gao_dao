# “高岛易断” Chrome 扩展项目文档

## 1. 项目概述 (Project Overview)

**项目名称**：高岛易断 Chrome 扩展

**项目目标**：开发一款Chrome浏览器扩展程序，允许用户通过输入特定数字（模拟起卦过程）来得到《高岛易断》中的对应卦象、爻辞及相关解释。扩展的核心功能是简化易经占卜的查询过程，并以清晰、便捷的方式展示结果。

**核心用户价值**：
*   快速便捷地进行易经起卦和结果查询。
*   提供《高岛易断》的卦象和爻辞解释，辅助用户理解。
*   集成化的浏览器体验，无需跳转到其他网站或应用。

**主要功能模块**：
1.  用户输入界面（性别选择、数字输入）。
2.  卦象计算逻辑。
3.  卦象结果展示（包括卦名、卦序、上下卦、动爻、爻辞）。
4.  卦象详解内容展示。

## 2. 需求文档 (Requirements Document)

#### 2.1 功能性需求 (Functional Requirements)

*   **FR1: 用户性别选择**
    *   **FR1.1**: 扩展应提供一个界面，允许用户选择“男”或“女”作为起卦的第一步。
    *   **FR1.2**: 根据性别选择，可能会有不同的后续提示或计算逻辑（当前设计中，主要影响提示语）。
*   **FR2: 数字输入与提示**
    *   **FR2.1**: 在选择性别后，界面应引导用户输入三个数字。
    *   **FR2.2**: 第一个数字用于确定上卦（输入数字 % 8，余0作8）。
    *   **FR2.3**: 第二个数字用于确定下卦（输入数字 % 8，余0作8）。
    *   **FR2.4**: 第三个数字用于确定动爻（输入数字 % 6，余0作6）。
    *   **FR2.5**: 界面应提供清晰的提示，说明每个数字的用途（例如，“男性请输入：左手为上卦，右手为下卦”）。
*   **FR3: 卦象计算**
    *   **FR3.1**: 系统需内置八卦信息（乾、坤、震、巽、坎、离、艮、兑的编号、名称、象征等）。
    *   **FR3.2**: 系统需能根据上卦和下卦的编号，准确查出对应的六十四卦卦序和卦名（例如，乾上乾下为第1卦“乾为天”）。
    *   **FR3.3**: 系统需能根据卦名和动爻位置（1-6），从预设数据（如 `gua_link.csv` 解析结果）中查出动爻的具体名称（如“初九”、“上六”）。
    *   **FR3.4**: 系统需能根据卦名和动爻位置，从对应的 `assets/html_combined/hexagram_XX_combined.html` 文件中提取该动爻的爻辞文本。
*   **FR4: 计算结果初步展示**
    *   **FR4.1**: 在用户输入数字并点击“计算卦象”后，系统应展示一个中间结果摘要，包含：上卦编号及信息、下卦编号及信息、动爻位置、卦象名称。（参考第三张截图）
*   **FR5: 卦象详解展示（悬浮框/信息面板）**
    *   **FR5.1**: 当用户触发查看详解（例如点击“查看卦象详解”或直接进入下一步），系统应显示一个包含详细信息的面板（参考第一张截图）。
    *   **FR5.2**: 该面板应包含：
        *   卦名（如“乾为天”）
        *   卦序（如“1”）
        *   上卦（如“乾 (天)”）
        *   下卦（如“乾 (天)”）
        *   动爻名称（如“上九”）
        *   动爻爻辞（如“上九: 亢龙有悔”）
        *   固定的“赞赏支持”模块（微信、支付宝占位图）。
    *   **FR5.3 (Chrome 扩展特定)**: 此面板应通过内容脚本注入到目标页面，并固定显示在页面右上角。数据通过 `chrome.storage.local` 从后台或 popup 传递。
*   **FR6: 卦象原始 HTML 详解内容展示**
    *   **FR6.1**: 除了 FR5 的摘要面板，系统还应能加载并显示对应卦的完整 HTML 解释内容（源自 `assets/html_combined/` 目录）。
    *   **FR6.2 (Chrome 扩展特定)**: 这个内容将作为内容脚本注入页面的主要部分，或在新tab/扩展页面中打开。目前您的截图显示它是作为一个 `chrome-extension://` URL 打开的，其中包含了爻的定位参数 (`changeLine=2`)。

#### 2.2 非功能性需求 (Non-Functional Requirements)

*   **NFR1: 易用性**：界面应简洁直观，用户操作流程清晰。
*   **NFR2: 性能**：卦象计算和结果展示应快速响应。HTML文件加载不应造成明显卡顿。
*   **NFR3: 准确性**：卦象、爻辞及相关解释必须准确无误。
*   **NFR4: 兼容性**：作为Chrome扩展，应兼容最新及主流稳定版Chrome浏览器。
*   **NFR5: 可维护性**：代码结构清晰，易于理解和修改。数据（如卦象信息、HTML文件）管理有序。

#### 2.3 数据需求 (Data Requirements)

*   **DR1**: 八卦基础数据（名称、编号、象征等）。
*   **DR2**: 六十四卦映射表（上下卦组合 -> 卦序、卦名）。
*   **DR3**: 动爻名称数据（卦名 + 动爻位置 -> 动爻具体名称，如 `gua_link.csv`）。
*   **DR4**: 六十四卦详解HTML文件 (`assets/html_combined/`)，包含爻辞等详细内容。
*   **DR5**: （可选）卦象图片资源 (`assets/hexagram_images/`)，若要在详解中显示。

## 3. 项目目录结构 (Project Directory Structure)

根据Chrome扩展的规范和项目需求，建议目录结构如下：
gao_dao_y_extension/
├── manifest.json # 扩展清单文件，核心配置文件
├── icons/ # 扩展图标
│ ├── icon16.png
│ ├── icon48.png
│ └── icon128.png
├── popup/ # 扩展弹窗相关 (如果用户交互起点是popup)
│ ├── popup.html
│ ├── popup.css
│ └── popup.js
├── background/ # 后台脚本 (如果计算和存储逻辑放在后台)
│ └── background.js
├── content_scripts/ # 内容脚本
│ ├── content_script.js
│ └── content_style.css # 悬浮框/信息面板的样式
├── assets/ # 静态资源
│ ├── data/ # 结构化数据
│ │ ├── trigrams.js # 八卦数据
│ │ ├── hexagram_map.js # 64卦映射
│ │ └── gua_link_parsed.js # 解析后的gua_link.csv数据
│ ├── html_combined/ # 64卦详解HTML文件
│ │ ├── hexagram_01_combined.html
│ │ └── ... (63 more files)
│ └── images/ # 其他图片资源 (如赞赏码占位图)
│ ├── wechat_placeholder.png
│ └── alipay_placeholder.png
├── utils/ # 工具函数/共享模块
│ └── calculation_logic.js # 卦象计算核心逻辑
├── pages/ # 扩展内部页面 (如果详解在新tab或扩展页面打开)
│ └── hexagram_detail_page.html
│ └── hexagram_detail_page.js
└── tests/ # 测试文件
├── unit/ # 单元测试
│ └── calculation_logic.test.js
└── integration/ # 集成测试